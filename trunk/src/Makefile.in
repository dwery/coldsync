# Makefile.in
# $Id: Makefile.in,v 1.6 1999-08-25 09:53:10 arensb Exp $

# XXX - Explicitly write .c.o , .cc.o and executable targets:
# different compilers have different default rules, and I don't want
# to deal with them.

PACKAGE =	@PACKAGE@
VERSION =	@VERSION@

srcdir =	@srcdir@
subdir =	src
top_srcdir =	@top_srcdir@
curdir =	${top_srcdir}/${subdir}
prefix =	@prefix@
exec_prefix =	@exec_prefix@
BINDIR =	@bindir@

INSTALL =	@INSTALL@
INSTALLARGS =	-c -m 555

#CC =		@CC@
#DEFS =		@DEFS@
#CXX =		@CXX@
#CCC =		${CXX}		# For Sun's 'make'
# Grrr... For some reason, 'makedepend' and egcs under Redhat 6.0 insist
# on having "-I.". I thought it was implied.
#INCLUDES =	-I. -I${top_srcdir}
#CXXINCLUDES =	${INCLUDES}
#CFLAGS =	${DEFS} ${INCLUDES} @CFLAGS@
#CPPFLAGS =	@CPPFLAGS@ ${INCLUDES}
#LDFLAGS =	@LDFLAGS@ @LIBS@

MKDEP =		@MKDEP@

# Compatibility functions, included for systems that don't have them.
COMPAT =	@COMPAT@
COMPATOBJS =	@COMPATOBJS@

SRCS =		PConnection.c \
		util.c \
		pack.c \
		slp.c \
		cmp.c \
		padp.c \
		dlp.c \
		dlp_cmd.c \
		palm_errno.c \
		pdb.c \
		coldsync.c \
		archive.c \
		backup.c \
		restore.c \
		config.c \
		handledb.c \
		log.c \
		conduit.c \
		GenericConduit.cc \
		${COMPAT}

OBJS =		PConnection.o \
		util.o \
		pack.o \
		slp.o \
		cmp.o \
		padp.o \
		dlp.o \
		dlp_cmd.o \
		palm_errno.o \
		pdb.o \
		coldsync.o \
		archive.o \
		backup.o \
		restore.o \
		config.o \
		handledb.o \
		log.o \
		conduit.o \
		GenericConduit.o \
		${COMPATOBJS}

HEADERS =	PConnection.h \
		util.h \
		pack.h \
		slp.h \
		cmp.h \
		padp.h \
		dlp.h \
		dlp_cmd.h \
		palm_types.h \
		palm_errno.h \
		pdb.h \
		coldsync.h \
		archive.h \
		conduit.h \
		GenericConduit.hh

DISTDIR =	${top_srcdir}/${PACKAGE}-${VERSION}
DISTFILES =	${SRCS} ${HEADERS} \
		Makefile.in \
		cfmakeraw.c

CLEAN =		coldsync *.o *.bak *~ core *.core
DISTCLEAN =	Makefile .depend
SPOTLESS =

# Explicitly say how things are to be compiled: the default varies
# between systems.

CC =		@CC@
CXX =		@CXX@
DEFINES =	@DEFS@
INCLUDES =	-I. -I${top_srcdir}
CPPFLAGS =	${DEFINES} ${INCLUDES}
CFLAGS =	@CFLAGS@ ${CPPFLAGS}
CXXFLAGS =	${CFLAGS}
LIBS =		@LIBS@
LDFLAGS =	@LDFLAGS@ ${LIBS}

.SUFFIXES:	.c .o .cc

.c.o:
	${CC} ${CFLAGS} -c $<

.cc.o:
	${CXX} ${CXXFLAGS} -c $<

all:	coldsync

coldsync:	${OBJS}
	${CXX} ${CXXFLAGS} ${OBJS} -o $@ ${LDFLAGS}

install:	coldsync
	${INSTALL} ${INSTALLARGS} coldsync ${BINDIR}

# XXX - 'makedepend' doesn't find C++ dependencies. Need to explicitly
# specify -I/usr/include/g++
# Actually, 'gcc -M' generates a dependency list the right way. This
# may be exploited, but the sources then need to be separated into
# C_SRCS and CXX_SRCS.

depend:
	${MKDEP} ${DEFS} ${INCLUDES} ${SRCS}

distdir:	${DISTFILES}
	if test ! -d ${DISTDIR}/${subdir}; then \
		mkdir ${DISTDIR}/${subdir}; \
	fi
	cp -p ${DISTFILES} ${DISTDIR}/${subdir}

clean:
	-rm -f ${CLEAN}
distclean:
	-rm -f ${CLEAN} ${DISTCLEAN}
spotless:
	-rm -f ${CLEAN} ${DISTCLEAN} ${SPOTLESS}

# Egcs's toupper() is broken. Print a message about this.
config.o:	config.o.warning
config.o.warning:
	@echo "	If you're using egcs, ignore the warning about"
	@echo "	\"ANSI C forbids braced-groups within expressions\""
